<!DOCTYPE html>
<html lang='eng'>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv="x-ua-compatible" content='ie=edge'>
    <title>Friend Library</title>
    <link rel='stylesheet' type='text/css' href='resources/css/reset.css'>
    <link rel='stylesheet' type='text/css' href='resources/css/style.css'>
    <script src="https://kit.fontawesome.com/a230460b96.js" crossorigin="anonymous"></script>
</head>

<body>

    <header>



    </header>

    <main>

        <!--<object id='doc' type='text/html' data='https://docs.google.com/document/d/1-ZLjKlGju7nlxuxJAsEApgp0dH5_m9vAv-3FbVbvmXs/edit?usp=sharing' width='1000' height='200'></object>
        <p id='data'></p>-->

        <button id='authorize-button' onclick="authorizeGoogleAccess()">Authorize Google Sheets Access</button>
        <pre id='content'></pre>

    </main>

    <script type="text/javascript">

        // You should set your Google client ID and Google API key
          const GOOGLE_CLIENT_ID = '568492347305-j8vnjb6h2a0m5ngeek8v5m98rq1o1c49.apps.googleusercontent.com';
          const GOOGLE_API_KEY = 'AIzaSyASnWe7SMdFOyFdAiP-ksrKAeYkVwajbeo';
          //
    
          const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
    
         // Authorization scope should be declared for spreadsheet handing
         // multiple scope can he included separated by space
          const SCOPES = 'https://www.googleapis.com/auth/spreadsheets.readonly';
    
          let tokenClient;
          let gapiInited = false;
          let gisInited = false;
          //document.getElementById('authorize_btn').style.visibility = 'hidden';
          //document.getElementById('signout_btn').style.visibility = 'hidden';
    
          /**
           * Callback after api.js is loaded.
           */
          function gapiLoaded() {
            gapi.load('client', intializeGapiClient);
          }
    
          /**
           * Callback after the Google API client is loaded. Loads the
           * discovery doc to initialize the API.
           */
          async function intializeGapiClient() {
            await gapi.client.init({
              apiKey: GOOGLE_API_KEY,
              discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
            maybeEnableButtons();
          }
    
          /**
           * Callback after Google Identity Services are loaded.
           */
          function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
              client_id: GOOGLE_CLIENT_ID,
              scope: SCOPES,
              callback: '', // defined later
            });
            gisInited = true;
            maybeEnableButtons();
          }
    
          /**
           * Enables user interaction after all libraries are loaded.
           */
          function maybeEnableButtons() {
            if (gapiInited && gisInited) {
              document.getElementById('authorize_btn').style.visibility = 'visible';
            }
          }
    
          /**
           *  Sign in the user upon button click.
           */
          function authorizeGoogleAccess() {
            tokenClient.callback = async (resp) => {
              if (resp.error !== undefined) {
                throw (resp);
              }
              document.getElementById('signout_btn').style.visibility = 'visible';
              document.getElementById('authorize_btn').innerText = 'Refresh';
              await listMajors();
            };
    
            if (gapi.client.getToken() === null) {
              // Prompt the user to select a Google Account and ask for consent to share their data
              // when establishing a new session.
              tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
              // Skip display of account chooser and consent dialog for an existing session.
              tokenClient.requestAccessToken({prompt: ''});
            }
          }
    
          /**
           *  Sign out the user upon button click.
           */
          function signoutGoogle() {
            const token = gapi.client.getToken();
            if (token !== null) {
              google.accounts.oauth2.revoke(token.access_token);
              gapi.client.setToken('');
              document.getElementById('content').innerText = '';
              document.getElementById('authorize_btn').innerText = 'Authorize';
              document.getElementById('signout_btn').style.visibility = 'hidden';
            }
          }
    
          /**
           * Print the names and majors of students in a sample spreadsheet:
           * https://docs.google.com/spreadsheets/d/1aSSi9jk2gBEHXOZNg7AV7bJj0muFNyPLYwh2GXThvas/edit
           */
          async function listMajors() {
            let response;
            try {
              // Fetch first 10 files
              response = await gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: '1aSSi9jk2gBEHXOZNg7AV7bJj0muFNyPLYwh2GXThvas',
                range: 'Sheet1!A2:D',
              });
            } catch (err) {
              document.getElementById('content').innerText = err.message;
              return;
            }
            const range = response.result;
            if (!range || !range.values || range.values.length == 0) {
              document.getElementById('content').innerText = 'No values found.';
              return;
            }
            const output = range.values.reduce(
                (str, row) => `${str}${row[0]}, ${row[2]}\n`,
                'Birds, Insects:\n');
            document.getElementById('content').innerText = output;
          }
        </script>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script type='module' src='./resources/scripts/script.js'></script>
    <script async defer src='https://apis.google.com/js/api.js' onload='gapiLoaded()'></script>
    <script async defer src='https://accounts.google.com/gsi/client'onload='gisLoaded()'></script>

</body>




</html>